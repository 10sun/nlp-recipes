# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License.
#

# Pull request against these branches will trigger this build
pr: none
#- master
#- staging
trigger: none

steps:

- bash: |
    echo "##vso[task.prependpath]/usr/share/miniconda/bin"
  displayName: Add Conda to PATH

- bash: |
    python tools/generate_conda_file.py;
    ls -al;
    conda env create -n nlp -f nlp_cpu.yaml;
    conda env list
    # source activate nlp_gpu
  displayName: 'Creating Conda Environment with dependencies'

- bash: |
    source activate nlp;
    data;
    conda install -y -c conda-forge ipykernel;
    python -m ipykernel install --user --name nlp --display-name "nlp";
    conda install -y -c anaconda pytest;
    date;
    # Commenting out pytest since it contains bunch of tests from other project which are not applicable.
    # But keeping the line here to show how to run it once tests relevant to this project are added
    pytest --durations=0 tests/unit --junitxml=junit/test-unitttest.xml; #not running any tests for now
    ls -al;
    ls -al junit
  displayName: 'Run Unit tests'

- task: PublishTestResults@2
  condition: succeededOrFailed()
  inputs:
    testResultsFiles: '**/test-unitttest.xml'
    testRunTitle: 'Test results for PyTest'

- task: ComponentGovernanceComponentDetection@0
  inputs:
    scanType: 'Register'
    verbosity: 'Verbose'
    alertWarningLevel: 'High'

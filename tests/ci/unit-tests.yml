# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License.
#
variables:
  test: 'tests/ci/run_pytest.py'
  maxnodes : 4
  reponame : 'nlp'
  rg       : 'nlprg'
  wsname   : ''
# CPU
  vmsize'  : 'STANDARD_D3_V2'
  dockerproc : 'cpu'

jobs:
- job : unit_tests
  displayName : 'unit_tests'
  pool:
    vmImage: 'ubuntu-16.04'
# Pull request against these branches will trigger this build
pr: none
#- master
#- staging

#Any commit to this branch will trigger the build.
trigger: none

steps:

- bash: |
    echo "##vso[task.prependpath]/usr/share/miniconda/bin"
  displayName: Add Conda to PATH

- bash: |
    conda remove -q -n nlp --all -y
    python tools/generate_conda_file.py
    conda env create -n nlp -f nlp.yaml
    conda env list  
    # source activate nlp_gpu
  displayName: 'Creating Conda Environment with dependencies'

- bash: |
    source activate nlp
    python -m ipykernel install --user --name nlp --display-name "nlp"
    # Commenting out pytest since it contains bunch of tests from other project which are not applicable.
    # But keeping the line here to show how to run it once tests relevant to this project are added
    pytest tests/unit --junitxml=junit/test-unitttest.xml #not running any tests for now
  displayName: 'Run Unit tests'

- task: PublishTestResults@2
  inputs:
    testResultsFiles: '**/test-unitttest.xml'
    testRunTitle: 'Test results for PyTest'

- task: ComponentGovernanceComponentDetection@0
  inputs:
    scanType: 'Register'
    verbosity: 'Verbose'
    alertWarningLevel: 'High'
